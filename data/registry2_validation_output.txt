INFO     Sending request to Gemini model: gemini-2.5-flash (auth: API key,      
         attempt 1/3)                                                           
INFO     Sending request to Gemini model: gemini-2.5-flash (auth: API key,      
         attempt 1/3)                                                           
INFO     Sending request to Gemini model: gemini-2.5-flash (auth: API key,      
         attempt 1/3)                                                           
INFO     Sending request to Gemini model: gemini-2.5-flash (auth: API key,      
         attempt 1/3)                                                           
INFO     Sending request to Gemini model: gemini-2.5-flash (auth: API key,      
         attempt 1/3)                                                           
INFO     Sending request to Gemini model: gemini-2.5-flash (auth: API key,      
         attempt 1/3)                                                           
INFO     Sending request to Gemini model: gemini-2.5-flash (auth: API key,      
         attempt 1/3)                                                           
INFO     Sending request to Gemini model: gemini-2.5-flash (auth: API key,      
         attempt 1/3)                                                           
INFO     Sending request to Gemini model: gemini-2.5-flash (auth: API key,      
         attempt 1/3)                                                           
INFO     Sending request to Gemini model: gemini-2.5-flash (auth: API key,      
         attempt 1/3)                                                           
INFO     Sending request to Gemini model: gemini-2.5-flash (auth: API key,      
         attempt 1/3)                                                           
INFO     Sending request to Gemini model: gemini-2.5-flash (auth: API key,      
         attempt 1/3)                                                           
INFO     Sending request to Gemini model: gemini-2.5-flash (auth: API key,      
         attempt 1/3)                                                           
INFO     Sending request to Gemini model: gemini-2.5-flash (auth: API key,      
         attempt 1/3)                                                           
INFO     Sending request to Gemini model: gemini-2.5-flash (auth: API key,      
         attempt 1/3)                                                           
Loaded 15 records from data/knowledge/synthetic_notes_with_registry2.json
Validating 55 fields...
------------------------------------------------------------
ERROR extracting record 11: 1 validation error for RegistryRecord
prior_therapy
  Input should be 'None', 'Chemo', 'Radiation', 'Immunotherapy' or 'Prior Resection' [type=literal_error, input_value='left lung lavage 3 weeks prior', input_type=str]
    For further information visit https://errors.pydantic.dev/2.11/v/literal_error

============================================================
VALIDATION SUMMARY
============================================================
✗ fb_object_type                     :   0.0% (0/2)
✗ fb_removal_success                 :   0.0% (0/2)
✗ ebus_rose_available                :  42.9% (6/14)
✗ final_diagnosis_prelim             :  50.0% (7/14)
✗ disposition                        :  50.0% (7/14)
✗ stent_type                         :  50.0% (1/2)
✗ blvr_number_of_valves              :  50.0% (1/2)
✗ blvr_valve_type                    :  50.0% (1/2)
✗ fb_tool_used                       :  50.0% (1/2)
✗ airway_device_size                 :  54.5% (6/11)
✗ ebus_stations_sampled              :  66.7% (2/3)
✗ nav_tool_in_lesion                 :  66.7% (2/3)
✗ nav_rebus_used                     :  66.7% (2/3)
✗ cao_location                       :  66.7% (2/3)
✗ cao_obstruction_pre_pct            :  66.7% (2/3)
⚠ bleeding_severity                  :  71.4% (10/14)
⚠ linear_ebus_stations               :  75.0% (3/4)
⚠ ebus_intranodal_forceps_used       :  85.7% (12/14)
✓ sedation_type                      :  92.9% (13/14)
✓ airway_type                        :  92.9% (13/14)
✓ hypoxia_respiratory_failure        :  92.9% (13/14)
✓ ebus_systematic_staging            :  92.9% (13/14)
✓ pneumothorax                       : 100.0% (14/14)
✓ gender                             : 100.0% (14/14)
✓ ebus_needle_gauge                  : 100.0% (3/3)
✓ ebus_elastography_used             : 100.0% (14/14)
✓ patient_age                        : 100.0% (14/14)
✓ nav_rebus_view                     : 100.0% (3/3)
✓ nav_cryobiopsy_for_nodule          : 100.0% (3/3)
✓ nav_registration_error_mm          : 100.0% (2/2)
✓ nav_platform                       : 100.0% (2/2)
✓ stent_diameter_mm                  : 100.0% (2/2)
✓ stent_deployment_method            : 100.0% (2/2)
✓ stent_location                     : 100.0% (2/2)
✓ stent_length_mm                    : 100.0% (2/2)
✓ pleural_opening_pressure_measured  : 100.0% (1/1)
✓ blvr_cv_assessment_method          : 100.0% (2/2)
✓ pleurodesis_performed              : 100.0% (1/1)
✓ wll_dlt_used                       : 100.0% (1/1)
✓ wll_volume_returned_l              : 100.0% (1/1)
✓ wll_volume_instilled_l             : 100.0% (1/1)

============================================================
TOP ERROR DETAILS
============================================================

--- fb_object_type (0.0% accuracy) ---
  Record 13: expected 'Chicken bone fragment' but got 'Organic'
    Expected: Chicken bone fragment
    Got: Organic
  Record 14: expected 'Plastic pen cap' but got 'Inorganic'
    Expected: Plastic pen cap
    Got: Inorganic

--- fb_removal_success (0.0% accuracy) ---
  Record 13: expected 'True' but got 'Complete'
    Expected: True
    Got: Complete
  Record 14: expected 'True' but got 'Complete'
    Expected: True
    Got: Complete

--- ebus_rose_available (42.9% accuracy) ---
  Record 6: expected 'False' but got 'None'
  Record 7: expected 'False' but got 'None'
  Record 8: expected 'False' but got 'None'
  Record 9: expected 'False' but got 'None'
  Record 10: expected 'False' but got 'None'

--- final_diagnosis_prelim (50.0% accuracy) ---
  Record 0: expected 'No mediastinal metastasis identified on ROSE; final cytology pending' but got 'Benign'
    Expected: No mediastinal metastasis identified on ROSE; final cytology pending
    Got: Benign
  Record 6: expected 'Benign postintubation tracheal stenosis treated with balloon dilation and silicone stent' but got 'Other'
    Expected: Benign postintubation tracheal stenosis treated with balloon dilation and silicone stent
    Got: Other
  Record 8: expected 'Known squamous cell carcinoma with central airway obstruction; palliative airway stenting performed' but got 'Malignancy'
    Expected: Known squamous cell carcinoma with central airway obstruction; palliative airway stenting performed
    Got: Malignancy
  Record 10: expected 'Severe emphysema with collateral ventilation; not a BLVR candidate' but got 'Other'
    Expected: Severe emphysema with collateral ventilation; not a BLVR candidate
    Got: Other
  Record 12: expected 'Partial left lung lavage for PAP; staged approach planned' but got 'Other'
    Expected: Partial left lung lavage for PAP; staged approach planned
    Got: Other

--- disposition (50.0% accuracy) ---
  Record 4: expected 'Discharged home after PACU recovery' but got 'PACU Recovery'
    Expected: Discharged home after PACU recovery
    Got: PACU Recovery
  Record 6: expected 'Admitted overnight for airway monitoring' but got 'PACU Recovery'
    Expected: Admitted overnight for airway monitoring
    Got: PACU Recovery
  Record 7: expected 'Transferred to transplant ward for overnight observation' but got 'PACU Recovery'
    Expected: Transferred to transplant ward for overnight observation
    Got: PACU Recovery
  Record 10: expected 'Discharged home after recovery' but got 'Discharge Home'
    Expected: Discharged home after recovery
    Got: Discharge Home
  Record 12: expected 'Admitted to ICU on high-flow nasal cannula' but got 'ICU Admission'
    Expected: Admitted to ICU on high-flow nasal cannula
    Got: ICU Admission

Error log saved to: data/registry2_errors.jsonl
